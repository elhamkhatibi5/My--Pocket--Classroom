<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸŽ“ Pocket Classroom â€” Mini E-Learning Platform</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  :root {
    --bg: #121212;
    --card-bg: #1f1f1f;
    --accent: #4fc3f7;
    --text: #ffffff;
    --muted: #bbbbbb;
    --error: #ff5252;
    --success: #4caf50;
  }

  body {
    background-color: var(--bg);
    color: var(--text);
    font-family: "Segoe UI", sans-serif;
    min-height: 100vh;
  }

  .navbar {
    background-color: var(--card-bg);
  }

  .navbar .nav-btn.active {
    color: var(--bg);
    background-color: var(--accent);
  }

  .card {
    background-color: var(--card-bg);
    border: none;
    margin-bottom: 1rem;
  }

  .form-control, .form-select {
    background-color: #2a2a2a;
    color: var(--text);
    border: 1px solid #444;
  }

  .form-control:focus, .form-select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 0.2rem rgba(79, 195, 247, 0.25);
    background-color: #2a2a2a;
    color: var(--text);
  }

  button {
    transition: 0.2s;
  }

  button:hover {
    opacity: 0.85;
  }

  .capsule-card:hover {
    transform: translateY(-3px);
    transition: 0.2s;
  }

  .tag {
    display: inline-block;
    background-color: #333;
    color: var(--accent);
    padding: 2px 6px;
    border-radius: 4px;
    margin-right: 4px;
    font-size: 0.8rem;
  }

  .flashcard {
    cursor: pointer;
    perspective: 1000px;
    margin-bottom: 1rem;
  }

  .flashcard-inner {
    position: relative;
    width: 100%;
    transform-style: preserve-3d;
    transition: transform 0.6s;
  }

  .flashcard.flipped .flashcard-inner {
    transform: rotateY(180deg);
  }

  .flashcard-front, .flashcard-back {
    position: absolute;
    width: 100%;
    backface-visibility: hidden;
    padding: 1rem;
    border-radius: 8px;
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .flashcard-front {
    background-color: #333;
  }

  .flashcard-back {
    background-color: var(--accent);
    color: var(--bg);
    transform: rotateY(180deg);
  }

  .progress {
    height: 20px;
    margin-bottom: 1rem;
  }

  @media (max-width: 768px) {
    .d-flex.gap-3 {
      flex-direction: column;
      gap: 1rem !important;
    }
  }
</style>
</head>

<body>
  <!-- Header / Navbar -->
  <header class="navbar card-panel d-flex align-items-center justify-content-between p-3">
    <div class="d-flex gap-3 align-items-center">
      <div class="brand fs-4">ðŸŽ“ Pocket Classroom</div>
      <nav>
        <button class="btn btn-sm btn-outline-light btn-pill nav-btn active" data-section="library">Library</button>
        <button class="btn btn-sm btn-outline-light btn-pill nav-btn" data-section="create">Create</button>
        <button class="btn btn-sm btn-outline-light btn-pill nav-btn" data-section="study">Study</button>
      </nav>
    </div>
  </header>

  <!-- Main Column -->
  <div class="container my-4">
    <!-- Library Section -->
    <section id="library-section">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Library</h3>
        <input id="search-input" class="form-control form-control-sm" placeholder="Search capsules..." style="width:200px;">
      </div>
      <div id="library-list" class="row"></div>
    </section>

    <!-- Create Section -->
    <section id="create-section" class="d-none">
      <h3>Create Capsule</h3>
      <div class="mb-3">
        <label class="form-label">Title</label>
        <input id="capsule-title" class="form-control" placeholder="Capsule title" />
      </div>
      <div class="mb-3">
        <label class="form-label">Type</label>
        <select id="capsule-type" class="form-select">
          <option value="note">Note</option>
          <option value="flashcard">Flashcard</option>
          <option value="quiz">Quiz</option>
        </select>
      </div>
      <div class="mb-3" id="capsule-content-container">
        <label class="form-label">Content</label>
        <textarea id="capsule-content" class="form-control" rows="4" placeholder="Write your note here..."></textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Tags (comma separated)</label>
        <input id="capsule-tags" class="form-control" placeholder="e.g. math, physics" />
      </div>
      <div id="dynamic-fields"></div>
      <button id="save-capsule-btn" class="btn btn-primary mt-2">Save Capsule</button>
    </section>

    <!-- Study Section -->
    <section id="study-section" class="d-none">
      <h3>Study</h3>
      <div class="mb-3">
        <select id="study-select" class="form-select" style="width: 300px;">
          <option value="">Select a capsule...</option>
        </select>
      </div>
      <div id="study-container"></div>
    </section>
  </div>

<script>
  // --- LocalStorage Helper ---
  function getCapsules() {
    const data = localStorage.getItem("capsules");
    return data ? JSON.parse(data) : [];
  }
  function saveCapsules(capsules) {
    localStorage.setItem("capsules", JSON.stringify(capsules));
  }

  // --- Navbar Section Switching ---
  const navButtons = document.querySelectorAll(".nav-btn");
  const sections = {
    library: document.getElementById("library-section"),
    create: document.getElementById("create-section"),
    study: document.getElementById("study-section"),
  };
  navButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      navButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      Object.values(sections).forEach(s => s.classList.add("d-none"));
      sections[btn.dataset.section].classList.remove("d-none");
      if(btn.dataset.section === "library") renderLibrary();
      if(btn.dataset.section === "study") populateStudySelect();
      resetCreateForm();
    });
  });

  // --- Library Rendering ---
  const libraryList = document.getElementById("library-list");
  const searchInput = document.getElementById("search-input");
  function renderLibrary() {
    const capsules = getCapsules();
    const filter = searchInput.value.toLowerCase();
    libraryList.innerHTML = capsules
      .filter(c => c.title.toLowerCase().includes(filter) || c.tags.join().toLowerCase().includes(filter))
      .map((c, i) => `
        <div class="col-md-4">
          <div class="card capsule-card p-3">
            <h5>${c.title}</h5>
            <p>Type: ${c.type}</p>
            <div>${c.tags.map(t => `<span class="tag">${t}</span>`).join(' ')}</div>
            <div class="mt-2">
              <button class="btn btn-sm btn-outline-success" onclick="editCapsule(${i})">Edit</button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteCapsule(${i})">Delete</button>
            </div>
          </div>
        </div>
      `).join('');
  }
  searchInput.addEventListener("input", renderLibrary);

  // --- Create Capsule ---
  const capsuleType = document.getElementById("capsule-type");
  const capsuleContentContainer = document.getElementById("capsule-content-container");
  const dynamicFields = document.getElementById("dynamic-fields");
  function resetCreateForm() {
    document.getElementById("capsule-title").value = "";
    document.getElementById("capsule-content").value = "";
    document.getElementById("capsule-tags").value = "";
    dynamicFields.innerHTML = "";
    capsuleContentContainer.classList.remove("d-none");
  }
  capsuleType.addEventListener("change", () => {
    dynamicFields.innerHTML = "";
    capsuleContentContainer.classList.toggle("d-none", capsuleType.value !== "note");
    if(capsuleType.value === "flashcard") {
      dynamicFields.innerHTML = `
        <div id="flashcards-list"></div>
        <button class="btn btn-secondary btn-sm mt-2" id="add-flashcard-btn">Add Flashcard</button>
      `;
      const list = document.getElementById("flashcards-list");
      document.getElementById("add-flashcard-btn").addEventListener("click", () => {
        const idx = list.children.length + 1;
        const card = document.createElement("div");
        card.classList.add("mb-2");
        card.innerHTML = `
          <input class="form-control mb-1 flash-front" placeholder="Front of card #${idx}">
          <input class="form-control mb-1 flash-back" placeholder="Back of card #${idx}">
        `;
        list.appendChild(card);
      });
    }
    if(capsuleType.value === "quiz") {
      dynamicFields.innerHTML = `
        <div id="quiz-list"></div>
        <button class="btn btn-secondary btn-sm mt-2" id="add-quiz-btn">Add Question</button>
      `;
      const list = document.getElementById("quiz-list");
      document.getElementById("add-quiz-btn").addEventListener("click", () => {
        const idx = list.children.length + 1;
        const q = document.createElement("div");
        q.classList.add("mb-2");
        q.innerHTML = `
          <input class="form-control mb-1 quiz-question" placeholder="Question #${idx}">
          <input class="form-control mb-1 quiz-opt1" placeholder="Option 1">
          <input class="form-control mb-1 quiz-opt2" placeholder="Option 2">
          <input class="form-control mb-1 quiz-opt3" placeholder="Option 3">
          <input class="form-control mb-1 quiz-opt4" placeholder="Option 4">
          <input class="form-control mb-1 quiz-correct" placeholder="Correct option (1-4)">
        `;
        list.appendChild(q);
      });
    }
  });

  document.getElementById("save-capsule-btn").addEventListener("click", () => {
    const title = document.getElementById("capsule-title").value.trim();
    const type = capsuleType.value;
    const tags = document.getElementById("capsule-tags").value.split(",").map(t => t.trim()).filter(Boolean);
    if(!title) return alert("Title is required.");
    const capsules = getCapsules();
    let content = "";
    if(type === "note") {
      content = document.getElementById("capsule-content").value.trim();
      if(!content) return alert("Content is required for note.");
    }
    let flashcards = [];
    if(type === "flashcard") {
      const fronts = document.querySelectorAll(".flash-front");
      const backs = document.querySelectorAll(".flash-back");
      for(let i=0;i<fronts.length;i++){
        if(fronts[i].value && backs[i].value)
          flashcards.push({front: fronts[i].value, back: backs[i].value});
      }
      if(flashcards.length===0) return alert("Add at least one flashcard.");
    }
    let quiz = [];
    if(type === "quiz") {
      const qs = document.querySelectorAll(".quiz-question");
      qs.forEach((q, i)=>{
        const opts = [
          document.querySelectorAll(".quiz-opt1")[i].value,
          document.querySelectorAll(".quiz-opt2")[i].value,
          document.querySelectorAll(".quiz-opt3")[i].value,
          document.querySelectorAll(".quiz-opt4")[i].value
        ];
        const correct = parseInt(document.querySelectorAll(".quiz-correct")[i].value);
        if(q.value && opts.every(o=>o) && correct>=1 && correct<=4)
          quiz.push({question: q.value, options: opts, correct});
      });
      if(quiz.length===0) return alert("Add at least one valid quiz question.");
    }
    capsules.push({title,type,tags,content,flashcards,quiz});
    saveCapsules(capsules);
    alert("Capsule saved!");
    resetCreateForm();
  });

  // --- Edit / Delete ---
  window.deleteCapsule = function(idx){
    if(confirm("Delete this capsule?")){
      const capsules = getCapsules();
      capsules.splice(idx,1);
      saveCapsules(capsules);
      renderLibrary();
    }
  }

  window.editCapsule = function(idx){
    const capsules = getCapsules();
    const c = capsules[idx];
    document.getElementById("capsule-title").value = c.title;
    document.getElementById("capsule-tags").value = c.tags.join(",");
    capsuleType.value = c.type;
    capsuleType.dispatchEvent(new Event("change"));
    if(c.type==="note") document.getElementById("capsule-content").value = c.content;
    if(c.type==="flashcard"){
      const list = document.getElementById("flashcards-list");
      list.innerHTML = "";
      c.flashcards.forEach(f=>{
        const card = document.createElement("div");
        card.classList.add("mb-2");
        card.innerHTML = `<input class="form-control mb-1 flash-front" value="${f.front}">
                          <input class="form-control mb-1 flash-back" value="${f.back}">`;
        list.appendChild(card);
      });
    }
    if(c.type==="quiz"){
      const list = document.getElementById("quiz-list");
      list.innerHTML = "";
      c.quiz.forEach(q=>{
        const div = document.createElement("div");
        div.classList.add("mb-2");
        div.innerHTML = `
          <input class="form-control mb-1 quiz-question" value="${q.question}">
          <input class="form-control mb-1 quiz-opt1" value="${q.options[0]}">
          <input class="form-control mb-1 quiz-opt2" value="${q.options[1]}">
          <input class="form-control mb-1 quiz-opt3" value="${q.options[2]}">
          <input class="form-control mb-1 quiz-opt4" value="${q.options[3]}">
          <input class="form-control mb-1 quiz-correct" value="${q.correct}">
        `;
        list.appendChild(div);
      });
    }
    sections.create.classList.remove("d-none");
    navButtons.forEach(b => b.classList.remove("active"));
    document.querySelector("[data-section=create]").classList.add("active");
  }

  // --- Study ---
  const studySelect = document.getElementById("study-select");
  const studyContainer = document.getElementById("study-container");
  function populateStudySelect(){
    const capsules = getCapsules();
    studySelect.innerHTML = `<option value="">Select a capsule...</option>` + 
      capsules.map((c,i)=>`<option value="${i}">${c.title} (${c.type})</option>`).join("");
    studyContainer.innerHTML = "";
  }

  studySelect.addEventListener("change",()=>{
    const idx = studySelect.value;
    if(idx==="") {studyContainer.innerHTML=""; return;}
    const c = getCapsules()[idx];
    if(c.type==="note") {
      studyContainer.innerHTML = `<div class="card p-3"><h5>${c.title}</h5><p>${c.content}</p></div>`;
    }
    if(c.type==="flashcard"){
      studyContainer.innerHTML = "";
      c.flashcards.forEach(f=>{
        const div = document.createElement("div");
        div.classList.add("flashcard");
        div.innerHTML = `
          <div class="flashcard-inner">
            <div class="flashcard-front">${f.front}</div>
            <div class="flashcard-back">${f.back}</div>
          </div>
        `;
        div.addEventListener("click",()=>div.classList.toggle("flipped"));
        studyContainer.appendChild(div);
      });
    }
    if(c.type==="quiz"){
      let current = 0;
      let score = 0;
      function showQuestion(){
        if(current>=c.quiz.length){
          studyContainer.innerHTML = `<div class="card p-3"><h5>Quiz Completed!</h5><p>Score: ${score} / ${c.quiz.length}</p></div>`;
          return;
        }
        const q = c.quiz[current];
        studyContainer.innerHTML = `
          <div class="card p-3">
            <h5>Q${current+1}: ${q.question}</h5>
            ${q.options.map((o,i)=>`<button class="btn btn-outline-light btn-sm mb-1 w-100 option-btn" data-idx="${i}">${o}</button>`).join('')}
          </div>
        `;
        document.querySelectorAll(".option-btn").forEach(btn=>{
          btn.addEventListener("click",()=>{
            if(parseInt(btn.dataset.idx)+1===q.correct) score++;
            current++;
            showQuestion();
          });
        });
      }
      showQuestion();
    }
  });

  // Initial Render
  renderLibrary();

</script>
</
